<?php ini_set("memory_limit","12M"); ?><link href="<?=base_url()?>asset/admin/css/style.css" rel="stylesheet" type="text/css"><script type="text/javascript">	function report_pdf(){		                  var site = "<?php echo site_url()?>";           /* $.ajax({                url: site+"/laporan_penjualan/index",                success: function(response){			                $("#tab").html(response);                },            dataType:"html"  		            });            return false;*/			var periode_awal=document.getElementById('tanggal_awal').value;			var periode_akhir=document.getElementById('tanggal_akhir').value;			  location.href = site+"/laporan_piutang/report_pdf/"+periode_awal+'/'+periode_akhir;	}		function report_excel(){		document.getElementById("rekap_tabel1").value = document.getElementById("div_laporan").innerHTML;		document.getElementById("myform").submit();	}			function print(){		/*<form>		<input type="button" value="Print This Page" onClick="window.print()" />		</form>*/	}		</script>			<div id="tab-settings" class="tabs-content">					<button type="button" onclick="report_pdf()"><img src="<?=base_url()?>asset/admin/images/icons/fugue/tick-circle.png" width="16" height="16">REKAP PDF</button>					<button type="submit" onclick="report_excel()"><img src="<?=base_url()?>asset/admin/images/icons/fugue/tick-circle.png" width="16" height="16">REKAP EXCEL</button>								</div>	<?php	$attributes = array('class' => 'formccs', 'id' => 'myform', 'name'=> 'myform');		echo form_open('laporan_piutang/report_excel', $attributes);?>	<div id="div_laporan">	<input name="rekap_tabel1" id="rekap_tabel1" type="hidden" value="rekap_tabel1" />	<input name="periode_awal" id="tanggal_awal" type="hidden" value="<?=$periode_awal;?>" />	<input name="periode_akhir" id="tanggal_akhir" type="hidden" value="<?=$periode_akhir;?>" />		<table class="laporan" width="90%" border="1">		<tr><td colspan="10"><b>SAWERI GADING CELL</b></td></tr>		<tr><td colspan="10"><b>JL. S PARMAN 18 BANYUWANGI</b></td></tr>		<tr><td colspan="10"><b>TELP (0333)-411345</b></td></tr>		<tr><td colspan="10"><b></b><br/></td></tr>		<tr><td colspan="10" div align="center"><b>LAPORAN PIUTANG</b></td></tr>		<tr><td colspan="10"><b>PERIODE : <?php echo $this->fungsi->dateindo3('-',$periode_awal) . ' S/D ' .  $this->fungsi->dateindo3('-',$periode_akhir); ?></b></td></tr>		<tr><td colspan="10"><b>TANGGAL CETAK : <?php echo $this->fungsi->dateindo3('-',date('Y-m-d')) ?></b></td></tr>		<tr>			<th scope="col">NO</th>			<th scope="col">TANGGAL</th>			<th scope="col">PO NOMER</th>						<th scope="col">KET</th>			<th scope="col">JATUH TEMPO</th>						<th scope="col">PEMBELI</th>			<th scope="col">PENJUAL</th>						<th scope="col">PIUTANG (Rp)</th>						<th scope="col">ANGSURAN (Rp)</th>			<th scope="col">SISA (Rp)</th>		</tr>				<?php		$j=0;		$nama_pelanggan = null;		$piutang[] = 0;		$sum_angsuran = 0;		$sum_sisa = 0;				$var_angsuran = 0;		$var_sisa = 0;		$qty_perbrg = 0;			foreach($results->result() as $row)			{				$j=$j+1;												if ($nama_pelanggan==null){					$nama_pelanggan=$row->id_pelanggan;										$piutang[]=$row->piutang;					unset($piutang);				}				if($row->id_pelanggan!= $nama_pelanggan){							?>					<tr class="rowjumlah">						<td colspan="7">Jumlah</td>						<td align="right"><?php echo convert_rupiah_non_rp(array_sum($piutang)) ;?></td>						<td align="right"><?php echo convert_rupiah_non_rp($var_angsuran);?></td>						<td align="right"><?php echo convert_rupiah_non_rp($var_sisa);?></td>					</tr>		<?php															$qty_perbrg=0;						$nama_pelanggan=$row->id_pelanggan;						//$var_angsuran=0;						$var_angsuran=0;						$var_sisa=0;						unset($piutang);				}								/*$query = $this->db->query("SELECT angsuran_piutang.GLID,  angsuran_piutang.TOTAL as total, sum(angsuran_piutang.ANGSURAN) as angsuran, (angsuran_piutang.TOTAL-sum(angsuran_piutang.ANGSURAN)) as sisa 							FROM (`angsuran_piutang`) 							JOIN `daftar_piutang` ON `daftar_piutang`.`GLID` = `angsuran_piutang`.`GLID` 							WHERE `angsuran_piutang`.GLID='" . $row->GLID . "' group by `angsuran_piutang`.`GLID`");*/														$query = $this->db->query("SELECT angsuran_piutang.GLID,  							angsuran_piutang.TOTAL as total,							sum(angsuran_piutang.ANGSURAN) as angsuran, (penjualan.total-sum(angsuran_piutang.ANGSURAN)) as sisa 							FROM (`angsuran_piutang`) 							JOIN `daftar_piutang` ON `daftar_piutang`.`GLID` = `angsuran_piutang`.`GLID` 							JOIN `penjualan` ON `daftar_piutang`.`so_no` = `penjualan`.`so_no` 							WHERE  `angsuran_piutang`.GLID='" . $row->GLID . "' group by `angsuran_piutang`.`GLID`");				foreach($query->result() as $row_angsuran)				{					$sum_angsuran=$row_angsuran->angsuran;					$sum_sisa=$row_angsuran->sisa;				}				$sum_sisa = $row->piutang - $sum_angsuran;									$piutang[]=$row->piutang;		?>				<tr>					<td align="right" valign="middle"><?=$j;?></td>					<td align="left" valign="middle"><?=convert_date_mysql_indo($row->TANGGAL);?></td>					<!--<td align="right" valign="middle"><?//=' '.$row->so_no . '(' . $row->GLID . ')';?></td>-->					<td align="right" valign="middle"><?=' '.$row->so_no;?></td>					<td align="left" valign="middle"><?=$row->KET_TRANSASKSI?></td>					<td align="left" valign="middle"><??></td>										<td align="left" valign="middle"><?=$row->nama_pelanggan;?></td>					<td align="left" valign="middle"><?=$row->nama_cabang?></td>					<td align="right" valign="middle"><?=convert_rupiah_non_rp($row->piutang);?></td>										<td align="right" valign="middle"><?=convert_rupiah_non_rp($sum_angsuran);  ?></td>					<td align="right" valign="middle"><?=convert_rupiah_non_rp($sum_sisa);  ?></td>					<?php if (isset($row->piutang)){$sum_piutang[]=$row->piutang;}?>					<?php if (isset($row->piutang)){$all_sum_angsuran[]=$sum_angsuran;}?>					<?php if (isset($row->piutang)){$all_sum_sisa[]=$sum_sisa;}?>				</tr>		<?php					$var_angsuran=$var_angsuran+$sum_angsuran;					//$var_sisa=$var_sisa+$sum_sisa;					$var_sisa=$var_sisa+$sum_sisa;					$sum_angsuran=0;					$sum_sisa=0;			}					?>						<tr class="rowjumlah">						<td colspan="7">Jumlah : </td>						<td align="right"><?=convert_rupiah_non_rp(array_sum($piutang))?></td>						<td align="right"><?=convert_rupiah_non_rp($var_angsuran=$var_angsuran+$sum_angsuran)?></td>						<td align="right"><?=convert_rupiah_non_rp($var_sisa=$var_sisa+$sum_sisa)?></td>				</tr>			<tr>				<td colspan="7"><b>JUMLAH : </b></td>				<td align="right"><?php if (isset($row->piutang)){echo convert_rupiah_non_rp(array_sum($sum_piutang));} ?></td>				<td align="right"><?php if (isset($row->piutang)){echo convert_rupiah_non_rp(array_sum($all_sum_angsuran));} ?></td>				<td align="right"><?php if (isset($row->piutang)){echo convert_rupiah_non_rp(array_sum($all_sum_sisa));} ?></td>			</tr>	</table></div></form>